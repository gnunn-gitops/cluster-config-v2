apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: argocd-agent-workload-prod-local

resources:
- ../../base

patches:
  - patch: |
      - op: replace
        path: /spec/generators/0/matrix/generators/0/git/directories
        value:
          - path: apps/**/overlays/all
          - path: apps/**/overlays/workload
          - path: apps/**/overlays/workload-prod
          - path: apps/**/overlays/workload-prod-local
      - op: replace
        path: /spec/template/spec/project
        value: argocd-agent-workload-prod-local
      - op: replace
        path: /spec/template/spec/destination/name
        value: argocd-agent-workload-prod-local
      - op: replace
        path: /metadata/labels/cluster-name
        value: workload-prod-local
      - op: replace
        path: /spec/template/metadata/labels/cluster-name
        value: workload-prod-local

    target:
      kind: ApplicationSet
      name: cluster-config
